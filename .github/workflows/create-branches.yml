name: Create Branches

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Name of the branch to create'
        required: true
        type: string

jobs:
  create-branches:
    runs-on: ubuntu-latest
    steps:
    - name: Create branches in all repos
      run: |
        repos=("ismenablement/repoA" "ismenablement/repoB" "ismenablement/repoC" "ismenablement/repoD" "ismenablement/repoE")
        branch="${{ inputs.branch_name }}"
        for repo in "${repos[@]}"; do
          echo "Creating branch $branch in $repo"
          main_sha=$(curl -s -H "Authorization: token ${{ secrets.TOKEN }}" https://api.github.com/repos/$repo/git/refs/heads/main | jq -r .object.sha)
          echo "Main SHA for $repo: $main_sha"
          curl -X POST -H "Authorization: token ${{ secrets.TOKEN }}" -H "Content-Type: application/json" -d "{\"ref\": \"refs/heads/$branch\", \"sha\": \"$main_sha\"}" https://api.github.com/repos/$repo/git/refs
          echo "---"
        done